<!-- Admin Toolbar Injection Template -->
<!-- This script is injected when accessing /admin routes -->
<script>
// Check if we're in admin mode based on URL
const isAdminMode = window.location.pathname.includes('/admin') || window.location.search.includes('admin=true');

if (isAdminMode) {
    console.log('🔧 Admin mode detected - initializing toolbar...');
    console.log('🔍 Current URL:', window.location.href);
    console.log('🔍 Pathname:', window.location.pathname);
    
    // Load the admin toolbar
    const loadAdminToolbar = () => {
        console.log('📥 Loading admin toolbar script...');
        
        // Load toolbar CSS and JS with cache busting
        const toolbarScript = document.createElement('script');
        toolbarScript.src = `/admin-static/toolbar.js?v=${Date.now()}`;
        toolbarScript.onload = () => {
            console.log('✅ Admin toolbar script loaded successfully');
            
            // Wait a moment for toolbar to initialize
            setTimeout(() => {
                console.log('🔍 Window.adminToolbar:', window.adminToolbar);
                console.log('🔍 AdminToolbar available:', typeof window.adminToolbar);
                
                if (!window.adminToolbar) {
                    console.error('❌ AdminToolbar not found! Creating manually...');
                    // Try to create it manually
                    try {
                        if (typeof AdminToolbar !== 'undefined') {
                            window.adminToolbar = new AdminToolbar();
                            console.log('✅ Manually created AdminToolbar instance');
                        } else {
                            console.error('❌ AdminToolbar class not found');
                            return;
                        }
                    } catch (e) {
                        console.error('❌ Error creating AdminToolbar:', e);
                        return;
                    }
                }
                
                // Create admin toolbar button beside the LintAI watermark
                const adminButton = document.createElement('div');
                adminButton.id = 'admin-toolbar-button';
                adminButton.innerHTML = `
                    🔧 <span>Edit</span>
                `;
                adminButton.style.cssText = `
                    position: fixed;
                    bottom: 10px;
                    right: 160px;
                    z-index: 99999;
                    background: rgba(16, 185, 129, 0.9);
                    border: 1px solid rgba(255, 255, 255, 0.3);
                    color: white;
                    padding: 10px 16px;
                    border-radius: 25px;
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
                    font-size: 12px;
                    font-weight: 500;
                    text-decoration: none;
                    display: flex;
                    align-items: center;
                    gap: 5px;
                    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
                    transition: all 0.2s ease;
                    cursor: pointer;
                    opacity: 1;
                    pointer-events: auto;
                `;
                
                
                // Add simple hover effect
                adminButton.addEventListener('mouseenter', () => {
                    adminButton.style.background = 'rgba(16, 185, 129, 1)';
                    adminButton.style.transform = 'scale(1.05)';
                });
                adminButton.addEventListener('mouseleave', () => {
                    adminButton.style.background = 'rgba(16, 185, 129, 0.9)';
                    adminButton.style.transform = 'scale(1)';
                });
                
                // Add click handler to toggle toolbar
                adminButton.addEventListener('click', () => {
                    console.log('🔧 Admin button clicked!');
                    
                    if (window.adminToolbar) {
                        if (window.adminToolbar.isVisible) {
                            window.adminToolbar.hide();
                        } else {
                            window.adminToolbar.show();
                        }
                    }
                });
                
                console.log('➕ Adding admin button to page...');
                document.body.appendChild(adminButton);
                console.log('✅ Admin button added successfully');
                
                
                // Show welcome message
                setTimeout(() => {
                    if (window.adminToolbar && typeof window.adminToolbar.showStatus === 'function') {
                        console.log('📢 Showing welcome message...');
                        window.adminToolbar.showStatus('Admin mode activated! Click "Edit" to start editing', 'success');
                    } else {
                        console.log('ℹ️ Skipping welcome message - showStatus not available');
                    }
                }, 1000);
            }, 500); // Wait for toolbar initialization
        };
        toolbarScript.onerror = () => {
            console.error('❌ Failed to load admin toolbar script from /admin-static/toolbar.js');
        };
        
        console.log('📤 Appending toolbar script to head...');
        document.head.appendChild(toolbarScript);
    };
    
    // Load when DOM is ready
    if (document.readyState === 'loading') {
        console.log('⏳ DOM still loading, waiting for DOMContentLoaded...');
        document.addEventListener('DOMContentLoaded', loadAdminToolbar);
    } else {
        console.log('✅ DOM ready, loading toolbar immediately...');
        loadAdminToolbar();
    }
    
    // Clean admin mode - no visual clutter, just the edit button
} else {
    console.log('ℹ️ Regular viewing mode - no admin features loaded');
    console.log('🔍 Current pathname:', window.location.pathname);
    console.log('🔍 Search params:', window.location.search);
}
</script>